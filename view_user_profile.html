<#attempt>
	<#assign
		userLocalService = serviceLocator.findService( "com.liferay.portal.kernel.service.UserLocalService" )
		user = userLocalService.getUserByScreenName( themeDisplay.companyId, themeDisplay.request.getParameter( "user" )!"" )
	/>
<style>
#user-profile-container .panel.panel-collapse.collapse.in:last-of-type {
  background-color: lime;
}

#user-profile-container .profile, #user-profile-container .content {
  margin-top: 25px;
}
#user-profile-container .name {
  font-size: 22px;
  font-weight: 500;
  color: #0e3f51;
  text-transform: uppercase;
}
#user-profile-container .sub-title {
  font-size: 12px;
  font-weight: 600;
  color: #c2c2c2;
}
#user-profile-container .content-detail {
  font-size: 15px;
  font-weight: 300;
  color: #343441;
}
#user-profile-container .info-header.row{
  margin-left: 0;
  margin-right: 0;
  border-radius: 5px 5px 0 0;
  background-color: #fafafa;
  border: solid 1px #ededed;
}
#user-profile-container .info-header {
  border-bottom: solid 1px #ededed;
}
#user-profile-container .user-title {
  background-image: url(../images/user-details.svg);
}
#user-profile-container .info-title {
  background-image: url(../images/contact-details.svg);
}
#user-profile-container .group-title {
	background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAXCAYAAAAP6L+eAAAAAXNSR0IArs4c6QAAA1ZJREFUOBF91FuIVVUcB+A5M+pM0t0uYqZF4XSzIBIykaQLRiGVlBGKSZZGRD31Wg5RD1EPPQRTaFEQ1WjUS1CZebwQPXiJsmy0dBq7qGWJ1YiXPH2/fc6W3Qj+4WOtvdd97bV2W9tJotFojGFUqkhv57ZWvjNlJ2l6YpEGHeVb+TdYxSTqrXy3dDXLKvWOtynfnZBq0EM6nMx6Er0c5lArL2ms4WpS9+nhHY0Y/sLzVcxmJk/yGTcykkQ3PXzPSs7jXf4XRcdGnODtxfxOsafSfdzLZqoTOMXzYe4hddJxhz4yoez7jlqttqtdJvEAdd6jRuI3LuApvuYnMnAGeobx7CXRxfvUmU9b2XGf/H4Okg4TyXcWuebMP5TPwHeRdllZ6iTSZog/WU6zY1Pvl3+CLfzF8Djbi0hnYyuF5eoOePcVj+trW8pH2JuzpI+xmCz9LTLy6VQHSac3U8bfMqnzB9nn+5mhv4nSl3Pw51GNrR6Ws4e+SsFr8kOV55SlTur2V94nOyd79TZ38wnZ58vIgd9Jvv4vJHLcyj3fLX+EH0jdSaTtR9zJinKP5Itre6HkPi4n5/cc8lHyrk6WPJl3yCA5Jdmeb+nLMZMWUT2fbSmwjEElU7mJNBjgIWVJs3WZXQa4nlkcY1u1U8/NUPkWFpLDX4T8HNI4nT3ISyxiPHPJzFM2i1tb+anyC2jeUpkVJJZSo51BXucFDpCf0X6eYwsf0MU+Unckn7KJ9nIrDhkxS1rILsvqUZjD32A623mE1NtDF7koN5DzfRpTuJJe7Y/lVCRG8Q1vskSni6U5EUd5kQl8R27VND7mfFIvg/7MIs5gFc3QUbZiI6NZyb/kzL5KLtE47mADO5nIXo7yPK+Q3+oAmf3xf0VmfKolDEnnkdnnQ2bJ+Y9kJZeQ7coW/UqufwdrWUc+2AZ9FLe13OPVXm4lRy63KRfmWdaQpT7KfPKHW6JOZtcrv5vPySSyTUsporggKl3hKf+Mf7iIAfKRriM3Kg3zIdNR2owmMYa0yf8iH/YaNht4e/Yvs55JGqTiRh5msPXcL51CPmQnqX+ELD3v6swl1zs3MX+65k9d5zPkryV7eynZmtyubs5lE2PJIDlS6zmT2fzIF+TYpdMvzfjgf4Y5RZqae/TRAAAAAElFTkSuQmCC')


}
#user-profile-container .user-title, #user-profile-container .info-title, #user-profile-container .group-title {
  background-repeat: no-repeat;
  background-position: 1em .7em;
  font-size: 15px;
  font-weight: 500;
  color: #0e3f51;
  border-right:solid 1px #ededed;
  padding: 10px;
  padding-left: 40px;
}
#user-profile-container .info-btn {
  font-size: 12px;
  font-weight: bold;
  color: #0e3f51;
  text-align: center;
  padding: 12px;
}
#user-profile-container .info-details {
  padding: 15px;
  border-radius: 0 0 5px 5px;
  background-color: #fafafa;
  border: solid 1px #ededed;
  min-height: 210px;
  margin-bottom: 20px;
}
#user-profile-container .content .col-xs-9, #user-profile-container .content .col-xs-3 {
  padding-left: 0;
  padding-right: 0;
}
#user-profile-container .group-label {
  font-size: 12px;
  color: #0e3f51;
}
#user-profile-container .group-btn {
  width: auto;
	height: 26px;
	border-radius: 5px;
	background-color: #0e3f51;
	font-size: 14px;
	color: #ffffff;
  text-align: center;
  padding: 3px 8px 0 8px;
  margin: 5px;
}
#user-profile-container .avatar {
  width: 94px;
  height: 94px;
  border-radius: 50%;
}
#user-profile-container .panel a{
  text-decoration: none;
}
#user-profile-container .panel {
  margin-bottom: 0;
  border: 0;
}
#user-profile-container .parent-btn {
	border-bottom: solid 1px #ededed;
	color: #ffffff;
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAXCAYAAAAP6L+eAAAAAXNSR0IArs4c6QAAA1ZJREFUOBF91FuIVVUcB+A5M+pM0t0uYqZF4XSzIBIykaQLRiGVlBGKSZZGRD31Wg5RD1EPPQRTaFEQ1WjUS1CZebwQPXiJsmy0dBq7qGWJ1YiXPH2/fc6W3Qj+4WOtvdd97bV2W9tJotFojGFUqkhv57ZWvjNlJ2l6YpEGHeVb+TdYxSTqrXy3dDXLKvWOtynfnZBq0EM6nMx6Er0c5lArL2ms4WpS9+nhHY0Y/sLzVcxmJk/yGTcykkQ3PXzPSs7jXf4XRcdGnODtxfxOsafSfdzLZqoTOMXzYe4hddJxhz4yoez7jlqttqtdJvEAdd6jRuI3LuApvuYnMnAGeobx7CXRxfvUmU9b2XGf/H4Okg4TyXcWuebMP5TPwHeRdllZ6iTSZog/WU6zY1Pvl3+CLfzF8Djbi0hnYyuF5eoOePcVj+trW8pH2JuzpI+xmCz9LTLy6VQHSac3U8bfMqnzB9nn+5mhv4nSl3Pw51GNrR6Ws4e+SsFr8kOV55SlTur2V94nOyd79TZ38wnZ58vIgd9Jvv4vJHLcyj3fLX+EH0jdSaTtR9zJinKP5Itre6HkPi4n5/cc8lHyrk6WPJl3yCA5Jdmeb+nLMZMWUT2fbSmwjEElU7mJNBjgIWVJs3WZXQa4nlkcY1u1U8/NUPkWFpLDX4T8HNI4nT3ISyxiPHPJzFM2i1tb+anyC2jeUpkVJJZSo51BXucFDpCf0X6eYwsf0MU+Unckn7KJ9nIrDhkxS1rILsvqUZjD32A623mE1NtDF7koN5DzfRpTuJJe7Y/lVCRG8Q1vskSni6U5EUd5kQl8R27VND7mfFIvg/7MIs5gFc3QUbZiI6NZyb/kzL5KLtE47mADO5nIXo7yPK+Q3+oAmf3xf0VmfKolDEnnkdnnQ2bJ+Y9kJZeQ7coW/UqufwdrWUc+2AZ9FLe13OPVXm4lRy63KRfmWdaQpT7KfPKHW6JOZtcrv5vPySSyTUsporggKl3hKf+Mf7iIAfKRriM3Kg3zIdNR2owmMYa0yf8iH/YaNht4e/Yvs55JGqTiRh5msPXcL51CPmQnqX+ELD3v6swl1zs3MX+65k9d5zPkryV7eynZmtyubs5lE2PJIDlS6zmT2fzIF+TYpdMvzfjgf4Y5RZqae/TRAAAAAElFTkSuQmCC')


}
#user-profile-container .collapsed .parent-btn {
  background-color: #0e3f51;
}
#user-profile-container .parent-btn {
  background-color: #4ab9b8;
}
#user-profile-container .child-btn {

	background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='25' height='23' viewBox='0 0 25 23'><g fill='#0E3F51' fill-rule='evenodd'><path d='M24.369 21.564h-.962v-10.27A1.348 1.348 0 0 0 22.07 9.94h-3.535V1.507A1.346 1.346 0 0 0 17.199.156H8.063a1.347 1.347 0 0 0-1.336 1.351v8.434H3.192a1.346 1.346 0 0 0-1.336 1.352v10.27H.884a.636.636 0 0 0-.632.64c0 .353.284.638.632.638h23.485a.635.635 0 0 0 .63-.639.636.636 0 0 0-.63-.638zm-2.3-10.345c.04 0 .072.034.072.075v10.27h-3.616V11.219h3.543zM7.986 1.508c0-.041.034-.074.074-.074h9.128c.04 0 .073.033.073.074v20.056H7.99L7.987 1.508zm-4.879 9.786c0-.041.034-.075.074-.075h3.536v10.345h-3.61v-10.27z'/><path d='M10.101 19.693h5.05a.635.635 0 0 0 .632-.639.636.636 0 0 0-.631-.639H10.1a.636.636 0 0 0-.631.639c0 .353.283.639.631.639zM10.101 16.652h5.05a.636.636 0 0 0 .632-.639.635.635 0 0 0-.631-.639H10.1a.635.635 0 0 0-.631.64c0 .351.283.638.631.638zM10.101 13.611h5.05a.636.636 0 0 0 .632-.638.635.635 0 0 0-.631-.64H10.1a.635.635 0 0 0-.631.64c0 .352.283.638.631.638zM10.101 10.573h5.05a.636.636 0 0 0 .632-.64.635.635 0 0 0-.631-.638H10.1a.635.635 0 0 0-.631.639c0 .352.283.639.631.639zM10.101 7.531h5.05a.635.635 0 0 0 .632-.639.636.636 0 0 0-.631-.639H10.1a.636.636 0 0 0-.631.64c0 .352.283.638.631.638zM10.101 4.49h5.05a.636.636 0 0 0 .632-.639.635.635 0 0 0-.631-.639H10.1a.635.635 0 0 0-.631.64c0 .352.283.638.631.638z'/></g></svg>") no-repeat;

}
#user-profile-container .child-btn-user {
  	background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='23' viewBox='0 0 18 23'><path fill='#0E3F51' fill-rule='evenodd' d='M8.862 0c-2.63 0-4.708 2.366-4.708 5.202s2.079 5.203 4.708 5.203c2.628 0 4.707-2.367 4.707-5.203C13.57 2.366 11.49 0 8.862 0zM9 1.095c2.035 0 3.738 1.802 3.738 4.107 0 2.306-1.703 4.108-3.738 4.108S5.262 7.508 5.262 5.202c0-2.305 1.703-4.107 3.738-4.107zm-4.765 11.5C1.898 12.595 0 14.461 0 16.757v5.723c0 .286.237.52.53.52h16.94c.293 0 .53-.234.53-.52v-5.723c0-2.296-1.898-4.162-4.235-4.162h-9.53zm.03 1.095h9.47c1.759 0 3.157 1.365 3.157 3.08v5.135H1.108V16.77c0-1.716 1.398-3.08 3.157-3.08z'/></svg>") no-repeat;
}
#user-profile-container .child-btn, #user-profile-container .child-btn-user {
  background-color: #fafafa;
	color: #343441;
}
#user-profile-container .child-btn:hover, #user-profile-container .child-btn-user:hover {
  background-color: #ededed;
}
#user-profile-container .parent-btn, #user-profile-container .child-btn, #user-profile-container .child-btn-user {
  padding-top: 17px;
  height: 55px;
  font-size: 14px;
  background-repeat: no-repeat;
  background-position: 1em .7em;
  padding-left: 50px;
	border: solid 1px #ededed;
}
#user-profile-container .child-btn.highlight, #user-profile-container .child-btn.highdark {
  color: #ffffff;
	background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='25' height='23' viewBox='0 0 25 23'><g fill='#FFF' fill-rule='evenodd'><path d='M24.369 21.564h-.962v-10.27A1.348 1.348 0 0 0 22.07 9.94h-3.535V1.507A1.346 1.346 0 0 0 17.199.156H8.063a1.347 1.347 0 0 0-1.336 1.351v8.434H3.192a1.346 1.346 0 0 0-1.336 1.352v10.27H.884a.636.636 0 0 0-.632.64c0 .353.284.638.632.638h23.485a.635.635 0 0 0 .63-.639.636.636 0 0 0-.63-.638zm-2.3-10.345c.04 0 .072.034.072.075v10.27h-3.616V11.219h3.543zM7.986 1.508c0-.041.034-.074.074-.074h9.128c.04 0 .073.033.073.074v20.056H7.99L7.987 1.508zm-4.879 9.786c0-.041.034-.075.074-.075h3.536v10.345h-3.61v-10.27z'/><path d='M10.101 19.693h5.05a.635.635 0 0 0 .632-.639.636.636 0 0 0-.631-.639H10.1a.636.636 0 0 0-.631.639c0 .353.283.639.631.639zM10.101 16.652h5.05a.636.636 0 0 0 .632-.639.635.635 0 0 0-.631-.639H10.1a.635.635 0 0 0-.631.64c0 .351.283.638.631.638zM10.101 13.611h5.05a.636.636 0 0 0 .632-.638.635.635 0 0 0-.631-.64H10.1a.635.635 0 0 0-.631.64c0 .352.283.638.631.638zM10.101 10.573h5.05a.636.636 0 0 0 .632-.64.635.635 0 0 0-.631-.638H10.1a.635.635 0 0 0-.631.639c0 .352.283.639.631.639zM10.101 7.531h5.05a.635.635 0 0 0 .632-.639.636.636 0 0 0-.631-.639H10.1a.636.636 0 0 0-.631.64c0 .352.283.638.631.638zM10.101 4.49h5.05a.636.636 0 0 0 .632-.639.635.635 0 0 0-.631-.639H10.1a.635.635 0 0 0-.631.64c0 .352.283.638.631.638z'/></g></svg>") no-repeat;
	background-color: #4ab9b8;
	background-position: center;
	background-position-x: 12px;
	font-weight: normal;
	margin: 0;
}
#user-profile-container .child-btn-user.bottomlevelhighlight {
	background-color: #ededed;
}
#user-profile-container .child-btn.highdark, #user-profile-container .parent-btn.highdark {
  background-color: #0e3f51;
  color: #ffffff;
}
#user-profile-container .parent-btn.darkback {
  background-color: #0e3f51;
}
#user-profile-container .fa-university {
  padding: 0 20px;
}
#user-profile-container .reset-web, #user-profile-container .reset-mobile {
  background-image: url(../images/reset.svg);
  background-repeat: no-repeat;
  background-position: 1em;
  padding: 5px 15px 5px 30px;
  font-size: 10px;
  font-weight: 600;
  text-align: right;
  color: #0e3f51;
  background-color: #fafafa;
  border-radius: 5px;
}
#user-profile-container .reset-web:hover, #user-profile-container .reset-mobile:hover {
  background-color: #ededed;
  cursor: pointer;
}
#user-profile-container .reset-mobile {
  display: none;
}
#user-profile-container .info {
  margin-bottom: 15px;
}

#user-profile-container .reset-web span, #user-profile-container .reset-mobile span {
	font-size: inherit;
	text-transform: uppercase;
}

@media (max-width: 991px) {
  #user-profile-container  .col-sm-12 {
    padding-left: 0;
    padding-right: 0;
  }
}

@media (max-width: 768px) {
  #user-profile-container .contacts, #user-profile-container .user-details {
    padding-bottom: 0;
  }
  #user-profile-container .avatar {
    width: 80px;
    height: 80px;
  }
  #user-profile-container .detail.col-xs-10.row {
    margin-right: 5px;
    margin-left: 5px;
  }
  #user-profile-container .reset-mobile {
    display: table;
  }
  #user-profile-container .reset-web {
    display: none;
  }
  #user-profile-container .all-content, #user-profile-container .directory {
    padding-left: 15px;
    padding-right: 15px;
  }

}
</style>

<div id="user-profile-container">
	<div class="profile">
		<div class="row">
			<div class="col-xs-3 col-sm-2">
				<!-- TODO change the icon to be just a placeholder -->
				<img class="avatar" src="${user.getPortraitURL( themeDisplay )}">
			</div>
			<div class="detail col-xs-9 col-sm-10 row">
				<div class="name col-xs-12">
					<span data-profile-bind="First Name">&nbsp;</span>&nbsp;<span data-profile-bind="Last Name">&nbsp;</span>
				</div>
				<div class="job-title col-xs-6 col-sm-3">
					<span class="sub-title">
						JOB TITLE
						<span>
							<p class="content-detail" data-profile-bind="Title/Role">&nbsp;</p>
						</span>
					</span>
				</div>
				<div class="mobile col-xs-6 col-sm-3">
					<span class="sub-title">MOBILE</span>
					<p class="content-detail" data-profile-bind="Business Mobile" >&nbsp;</p>
				</div>
			</div>
		</div>
	</div>
	<div class="reset-web pull-right" onclick="getLocation()" >
		SHOW <span data-profile-bind="First Name">&nbsp;</span> LOCATION
	</div>
	<div class="content">
		<div class="row">
			<div class="col-md-8 col-sm-6 all-content">
				<div class="col-md-6 col-sm-12">
					<div class="info">
						<div class="info-header row">
							<div class="col-xs-9">
								<div class="info-title">
									Contact Details
								</div>
							</div>
							<div class="col-xs-3">
								<a href="#contact-details" id="contact-text" class="" data-toggle="collapse" data-parent="#contact-details" onclick="toggletext('contact-text', 'info-btn')" aria-expanded="true">
									<div class="info-btn">HIDE</div>
								</a>
							</div>
						</div>
						<div class="info-details collapse in" id="contact-details" style="" aria-expanded="true">
							<span class="sub-title">WORK PHONE</span>
							<p class="content-detail" data-profile-bind="Business Phone">&nbsp;</p>
							<span class="sub-title">FAX</span>
							<p class="content-detail" data-profile-bind="Business Fax">&nbsp;</p>
							<span class="sub-title">STREET ADDRESS</span>
							<p class="content-detail">
								<span data-profile-bind="Business Street Address">&nbsp;</span><br/>
								<span data-profile-bind="Business Suburb">&nbsp;</span>,&nbsp;
								<span data-profile-bind="Business State">&nbsp;</span>,&nbsp;
								<span data-profile-bind="Business Post Code">&nbsp;</span>
							</p>
						</div>
					</div>
				</div>
				<div class="col-md-6 col-sm-12">
					<div class="info">
						<div class="info-header row">
							<div class="col-xs-9">
								<div class="user-title">
									User Details
								</div>
							</div>
							<div class="col-xs-3">
								<a href="#user-details" id="user-text" class="" data-toggle="collapse" data-parent="#user-details" onclick="toggletext('user-text', 'info-btn')" aria-expanded="true">
									<div class="info-btn">HIDE</div>
								</a>
							</div>
						</div>
						<div class="info-details collapse in" id="user-details" style="" aria-expanded="true">
							<span class="sub-title">DOE USER ID</span>
							<p class="content-detail" data-profile-bind="DET User ID">&nbsp;</p>
							<span class="sub-title">NETWORK USER</span>
							<p class="content-detail" data-profile-bind="Network User ID" >&nbsp;</p>
							<span class="sub-title">EMPLOYMENT ROLES</span>
							<p class="content-detail" data-profile-bind="Employment Roles">&nbsp;</p>
						</div>
					</div>
				</div>
				<div class="col-md-6 col-sm-12" style="clear: both;">
					<div class="info">
						<div class="info-header row">
							<div class="col-xs-9">
								<div class="group-title">
									Groups
								</div>
							</div>
							<div class="col-xs-3">
								<a href="#group-details" id="group-text" class="" data-toggle="collapse" data-parent="#group-details" onclick="toggletext('group-text', 'info-btn')" aria-expanded="true">
									<div class="info-btn">HIDE</div>
								</a>
							</div>
						</div>
						<div class="info-details collapse in" id="group-details" style="" aria-expanded="true">
							<p class="group-label">GROUPS</p>
							<div class="row">
								<#attempt>
									<#list user.userGroups as userGroup>
										<div class="group-btn col-xs-6">
											${userGroup.name}
										</div>
									</#list>
								<#recover>
								</#attempt>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-4 col-sm-6 directory">
				<div class="reset-mobile pull-right">
					SHOW <span data-profile-bind="First Name">&nbsp;</span> LOCATION
				</div>
				<div class="col-xs-12">
					<div id="side-bar-menu">
						<div id="MainMenu">
							<div class="list-group panel">




							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">

function renderProfile( response ) {
	var staffProfile = response.staffProfile;

	$( "[data-profile-bind]" ).each( function( index, element ) {
		var $element = $( element );
		var dataBind = $element.attr( "data-profile-bind" );
		var profileElement = staffProfile.find( function( it ) {
			return it.Name === dataBind;
		} );

		if ( profileElement ) {
			$element.text( ( profileElement.Value || "N/D" ).toString().split( "," ).join( ", " ) );
		}
	} );
}

function getObjectLevel( obj , orglist, allOrgNames) {
	if (obj.hasOwnProperty('children')) {
		if (obj.children.hasOwnProperty('name')) {
			allOrgNames.push(obj.children.name);
		}
		var ouValue = obj.attributes.entry.find( function( it ) {
			return it.key === "ou";
		} );
		if (ouValue) {
			orglist.push(ouValue.value);
		}

		getObjectLevel(obj.children, orglist, allOrgNames);
	} else {

		obj.forEach(function(element) {
			var currentUser = element.attributes.entry.find( function( it ) {
				return it.key === "detUserId";
			} );
			if (currentUser && currentUser.value.toLowerCase() === userScreenName) {
				var bottomchildlevel='';
				for (var i = 0; i < orglist.length; i++) {
					var newid='item-sub';
					for (var j = 0; j < i; j++) {
						newid+='sub';
					}
					var oldid = newid+i;
					newid = newid+'sub'+(i+1);
					if (i+1 === orglist.length) {
						bottomchildlevel = newid;
					}
					var dark = i < orglist.length-1 ? 'highdark':'';
					var light = i === orglist.length-1 ? 'highlight':'';

					$('#'+oldid).append(
							'<a href="#" class="collapsed" data-toggle="collapse" id="menu'+newid+'" data-parent="#'+newid+'" onclick="toggle(\''+oldid+'\', \''+newid+'\', \''+newid+oldid+'\', \''+allOrgNames[i]+'\')">\
								<div class="child-btn '+dark+light+'" id="button'+newid+oldid+'">\
									'+ orglist[i] +'\
								</div>\
							</a>\
							<div class="collapse in" id="'+newid+'">\
							</div>'
					);
				}
				obj.forEach(function(element) {
					var currentUser = element.attributes.entry.find( function( it ) {
						return it.key === "detUserId";
					} );
					var result = element.attributes.entry.find( function( it ) {
						return it.key === "cn";
					} );

					if (result && element.name.startsWith('cn') && currentUser && currentUser.value.toLowerCase() !== userScreenName) {
						$('#'+bottomchildlevel).append(
							'<a href="#" >\
								<div class="child-btn-user">\
									'+result.value+'\
								</div>\
							</a>'
						);
					} else if (result && element.name.startsWith('cn') && currentUser && currentUser.value.toLowerCase() === userScreenName) {
						$('#'+bottomchildlevel).prepend(
							'<a href="#" >\
								<div class="child-btn-user bottomlevelhighlight">\
									'+result.value+'\
								</div>\
							</a>'
						);
					}
				});

			}
		});
	}
}


function getOrgList( response ) {
	var ouValue = [];
	var allOrgNames = [];
	var topOrg = response.name.match(/(?<=o=)(.*)(?=\,)/)[0];
	$('#MainMenu .panel').empty();
	$('#MainMenu .panel').append('<a href="#item-sub0" class="collapsed" data-toggle="collapse" data-parent="#MainMenu" onclick="collapsing(\'menu-0\',\'item-sub0\', \''+response.name+'\')" aria-expanded="false">\
										<div id="menu-0">\
											<div class="parent-btn" id="item-0menu-0" style="border-radius: 5px 5px 0px 0px;">\
												'+ topOrg +'\
											</div>\
										</div>\
									</a>\
									<div class="collapse in" id="item-sub0" aria-expanded="true" style="">\
									</div>');
	getObjectLevel(response , ouValue, allOrgNames);
}


var userScreenName = new URL(location.href).searchParams.get( "user" )

$.ajax( {
	'type' : 'get',
	'url' : '/o/rest/profile/details/' + userScreenName
} ).then( renderProfile );

getLocation();

function getLocation(){
	$.ajax( {
		'type' : 'get',
		'url' : '/o/rest/profile/location/' + userScreenName
	} ).then( getOrgList );
}


$.ajax( {
	'type' : 'get',
	'url' : '/o/rest/profile/children/ou=delete- Disability Programs,ou=Access and Equity Directorate,ou=Public Schools,ou=School Operations and Performance,o=DET,c=AU'
} ).then( function (result){
	console.log('sa',result);
});


function renderSubmenu( response, parentId, subId) {
	$("#"+parentId+" [id^='menu']").not("#menu"+subId+"").remove();
	$("#"+parentId+" [id^='sub']").not("#"+subId+"").remove();
	$('#'+subId).empty();

	response.forEach(function(element,key) {
		var childElement = element.attributes.entry.find( function( it ) {
			return it.key === 'ou';
		} );
		var userElement = element.attributes.entry.find( function( it ) {
			return it.key === 'cn';
		} );
		var newid = 'sub'+subId+key;
		if ( childElement ) {
			$('#'+subId).append(
											'<a href="#'+newid+'" class="collapsed" data-toggle="collapse" id="menu'+newid+'" data-parent="#'+newid+'" onclick="toggle(\''+subId+'\', \''+newid+'\', \''+newid+subId+'\', \''+element.name+'\')">\
												<div class="child-btn" id="button'+newid+subId+'">\
													'+ childElement.value +'\
												</div>\
											</a>\
											<div class="collapse" id="'+newid+'">\
											</div>'
										);
		} else if (userElement) {
			$('#'+subId).append(
											'<a href="#'+newid+'" class="collapsed" data-toggle="collapse" id="menu'+newid+'" data-parent="#'+newid+'" onclick="toggle(\''+subId+'\', \''+newid+'\', \''+newid+subId+'\', \''+element.name+'\')">\
												<div class="child-btn-user" id="button'+newid+subId+'">\
													'+ userElement.value +'\
												</div>\
											</a>\
											<div class="collapse" id="'+newid+'">\
											</div>'
										);
		}
	});
}

function collapsing(id, subId, orgName) {
	if ($( ".parent-btn" ).hasClass('highdark')) {
		$( ".parent-btn" ).toggleClass( "highdark" );
	}

	$.ajax( {
		'type' : 'get',
		'url' : '/o/rest/profile/children/'+orgName
	} ).then( function (result){
		renderSubmenu(result,id,subId);
	});

}

function toggle(parentId,subId,clickId,orgName) {
	var parentsParentId = $( "#"+parentId+"").parent().attr('id');
	if (!$( ".parent-btn" ).hasClass('highdark')) {
		$( ".parent-btn" ).toggleClass( "highdark" );
	}
	if (!$( "#button"+parentId+parentsParentId+"" ).hasClass('highdark')) {
		$( "#button"+parentId+parentsParentId+"" ).toggleClass( "highdark" );
	}

	$( "#button"+clickId+"" ).removeClass("highdark").toggleClass( "highlight" );

	$( "#button"+parentId+"" ).parent().toggleClass( "darkback" );

	$( "[id^='"+parentId+"']" ).toggleClass( "darkback" );


	$.ajax( {
		'type' : 'get',
		'url' : '/o/rest/profile/children/'+orgName
	} ).then( function (result){
		renderSubmenu(result,parentId,subId);
	});

}




</script>
<#recover>
  <div>Sorry, we were unable to process this request.</div>
  <div class="hidden-error">${.error}</div>
</#attempt>
